
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>StepsRiverNetwork &#8212; StepsRiverNetwork 0.9 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">StepsRiverNetwork 0.9 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="align-right figure align-default">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="width: 7.5cm; height: 3cm;" /></a>
</div>
<div class="section" id="stepsrivernetwork">
<h1><strong>StepsRiverNetwork</strong><a class="headerlink" href="#stepsrivernetwork" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>StepsRiverNetwork simulates in-stream environmental fate processes of pesticides for
an entire river network of a catchment. Efate processes are calculated for each single
reach and transport across the entire catchment in an explicit timestep of minutes.</p>
<div class="align-center figure">
<img alt="_images/concept.png" src="_images/concept.png" />
</div>
<p>For simulating environmental processes the
STEPS1-2-3-4 appraoch by M. Klein (<a class="reference external" href="http://publica.fraunhofer.de/documents/N-73445.html">http://publica.fraunhofer.de/documents/N-73445.html</a>) has been implemented. The key features of STEPS-1-2-3-4 are as follow:</p>
<ul class="simple">
<li><p>A substance is defined by KOC and DT50.</p></li>
<li><p>The system consists of one water layer and two sediment layer.</p></li>
<li><p>Degradation is calculated by by DT50 in water and sediment.</p></li>
<li><p>Sorption / desorption are calculated by the gradient between water layer and pore water of sediment.</p></li>
</ul>
<div class="align-center figure">
<img alt="_images/concept_steps1234.png" src="_images/concept_steps1234.png" />
</div>
<p>STEPS1-2-3-4 solely simulates efate processes and hydrological data and compound inputs must be calculated in advance. Having all data at hand efat and solute flux across the whole river network is calculated for each timestep in relation to the followign scheme.</p>
<div class="align-center figure">
<img alt="_images/concept_steps1234_processes.png" src="_images/concept_steps1234_processes.png" />
</div>
</div>
<div class="section" id="input-data">
<h2>Input data<a class="headerlink" href="#input-data" title="Permalink to this headline">¶</a></h2>
<p>All input data files must be located in the respective project folder, except the Runlist.</p>
<div class="section" id="runlist">
<h3>RunList<a class="headerlink" href="#runlist" title="Permalink to this headline">¶</a></h3>
<div class="align-center figure">
<img alt="_images/data_input_RunList.png" src="_images/data_input_RunList.png" />
</div>
</div>
<div class="section" id="reachlist">
<h3>ReachList<a class="headerlink" href="#reachlist" title="Permalink to this headline">¶</a></h3>
<div class="align-center figure">
<img alt="_images/data_input_ReachList.png" src="_images/data_input_ReachList.png" />
</div>
</div>
<div class="section" id="catchmentlist">
<h3>CatchmentList<a class="headerlink" href="#catchmentlist" title="Permalink to this headline">¶</a></h3>
<div class="align-center figure">
<img alt="_images/data_input_CatchmentList.png" src="_images/data_input_CatchmentList.png" />
</div>
</div>
<div class="section" id="spraydriftlist">
<h3>SprayDriftList<a class="headerlink" href="#spraydriftlist" title="Permalink to this headline">¶</a></h3>
<div class="align-center figure">
<img alt="_images/data_input_SprayDriftList.png" src="_images/data_input_SprayDriftList.png" />
</div>
</div>
<div class="section" id="drainagelist">
<h3>DrainageList<a class="headerlink" href="#drainagelist" title="Permalink to this headline">¶</a></h3>
<div class="align-center figure">
<img alt="_images/data_input_DrainageList.png" src="_images/data_input_DrainageList.png" />
</div>
</div>
<div class="section" id="hydrolist">
<h3>HydroList<a class="headerlink" href="#hydrolist" title="Permalink to this headline">¶</a></h3>
<p>The HydroList can be provided by two alternative file formats.</p>
<ol class="arabic simple">
<li><p>CSV</p></li>
</ol>
<div class="align-center figure">
<img alt="_images/data_input_reach.png" src="_images/data_input_reach.png" />
</div>
<ol class="arabic simple" start="2">
<li><p>HDF5</p></li>
</ol>
<p>In this case, the file must called “HydroList.h5”. It must contain
three datasets for ‘area’ (wet surface, m2),
‘flow’ (m3/day) and ‘volume’ (m3) according to the parameter described above. Each dataset
must be  a two-dimensional array (shape: [ntime,nreaches]).</p>
</div>
</div>
<div class="section" id="output-data">
<h2>Output data<a class="headerlink" href="#output-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="environmental-fate">
<h3>Environmental fate<a class="headerlink" href="#environmental-fate" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>CSV</p></li>
</ol>
<p>A summary CSV-file with a hourly timestep is optionally created which includes the
hydrological and efate data. The hourly summary can be calculated as minimum, maximum or
mean per hour.</p>
<div class="align-center figure">
<img alt="_images/data_output_reach.png" src="_images/data_output_reach.png" />
</div>
<ol class="arabic simple" start="2">
<li><p>HDF5</p></li>
</ol>
<p>Up to five state variables (MASS_SW,MASS_SED,MASS_SED_DEEP,PEC_SW,PEC_SED)
are saved in a seprated hdf5-file. Each file contains a dataset named by the respective
parameter (eg. steps_MASS_SW.h5 –&gt; dset=”MASS_SW”) with a two-dimensional array
(shape: [ntime,nreaches]).</p>
</div>
</div>
<div class="section" id="quick-user-guide">
<h2>Quick user guide<a class="headerlink" href="#quick-user-guide" title="Permalink to this headline">¶</a></h2>
<p>The model can be executed by using a Python script and calling the related functions:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">RunFactory</span> <span class="kn">import</span> <span class="n">RunFactory</span>

<span class="k">def</span> <span class="nf">get_fdir</span><span class="p">(</span><span class="n">subfolder</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Return current working directoy and add subfolder to path.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
                  <span class="o">*</span><span class="n">subfolder</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">fdir</span>

<span class="n">FLAGS</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

  <span class="c1"># get command line arguments or use default</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--folder&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get_fdir</span><span class="p">([</span><span class="s2">&quot;projects&quot;</span><span class="p">]),</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path of project folder.&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--runlist&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Name of model run&#39;</span><span class="p">)</span>
  <span class="n">FLAGS</span><span class="p">,</span> <span class="n">unparsed</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>

  <span class="c1"># create run factory</span>
  <span class="n">runfactory</span> <span class="o">=</span> <span class="n">RunFactory</span><span class="p">(</span><span class="n">FLAGS</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span><span class="n">FLAGS</span><span class="o">.</span><span class="n">runlist</span><span class="p">)</span>

  <span class="c1"># setup model runs</span>
  <span class="n">runfactory</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

  <span class="c1"># conduct simulations</span>
  <span class="n">runfactory</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">printres</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>… or by using a batchfile by defining the variables ‘–folder’ and ‘–runlist’ which
area the the project folder and the name of the project:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>@echo off
<span class="nb">set</span> <span class="nv">script</span><span class="o">=</span>%cd%/bin/main.py
<span class="nb">set</span> <span class="nv">python</span><span class="o">=</span>%cd%/bin/Python/python.exe
call %python% %script% --folder c:/projects/test/ --runlist testrun
pause
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="about">
<h2>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h2>
<p>The tool is a development in a project by Bayer AG and knoell Germany GmbH.</p>
<p>Sebastian Multsch <sup>1</sup> , Stefan Reichenberger <sup>1</sup> ,Florian Krebs <sup>1</sup> , Thorsten Schad <sup>2</sup></p>
<p><sup>1</sup> <a class="reference external" href="https://www.knoellconsult.com/enf">knoell Germany GmbH</a></p>
<p><sup>2</sup> <a class="reference external" href="https://www.cropscience.bayer.de/">Bayer AG, Research &amp; Development, Crop Science</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><strong>StepsRiverNetwork</strong></a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#input-data">Input data</a><ul>
<li><a class="reference internal" href="#runlist">RunList</a></li>
<li><a class="reference internal" href="#reachlist">ReachList</a></li>
<li><a class="reference internal" href="#catchmentlist">CatchmentList</a></li>
<li><a class="reference internal" href="#spraydriftlist">SprayDriftList</a></li>
<li><a class="reference internal" href="#drainagelist">DrainageList</a></li>
<li><a class="reference internal" href="#hydrolist">HydroList</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output-data">Output data</a><ul>
<li><a class="reference internal" href="#environmental-fate">Environmental fate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-user-guide">Quick user guide</a></li>
<li><a class="reference internal" href="#about">About</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">StepsRiverNetwork 0.9 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, knoell Germany GmbH.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.0.
    </div>
  </body>
</html>